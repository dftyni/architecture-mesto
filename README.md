# pymongo-api-with-sharding-replication-with-cache

Я переписал немного приложение и добавил в него работу с Redis в кластерном режиме. Также я поменял переменную окружения
`REDIS_URL` на `USE_REDIS` - так более логично. А хосты зашил в код (переменная `redis_nodes` в файле app.py), 
при желании их также можно вынести на уровень переменных окружения.

## Запуск

**Перед началом выполнения команд необходимо перейти в директорию `sharding-repl-cache`.**
```shell
cd sharding-repl-cache
```

Разворачиваем приложение, MongoDB, Redis

```shell
docker compose up -d
```

Инициализируем MongoDB (Сервис конфигурации, Шарды, Роутер)
```shell
./scripts/mongo-init.sh
```
Старт и окончание каждого этапа инициализации выводится в консоль.

Инициализируем кластер Redis
```shell
./scripts/redis-init.sh
```
Старт и окончание каждого этапа инициализации выводится в консоль.

## Проверка

Выполняем проверку.
```shell
./scripts/check-data.sh
```
Результатом будет общее количество документов базе, а также количество документов на каждом шарде. Для Redis будут 
выведены все ноды кластера. Старт и окончание каждого этапа проверки выводится в консоль.

## Адреса сервиса

Домашняя страница: http://localhost:8080

Swagger: http://localhost:8080/docs
